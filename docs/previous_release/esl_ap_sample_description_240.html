<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sample description &mdash; ESL  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
  <script type="text/javascript" src="../_static/js/ncs.js"></script>

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <link rel="shortcut icon" href="../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ESL
          </a>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Subpages:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../environment_setup.html">Requirements and setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional_resources.html">Additional resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Previous release:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index_240.html">Welcome to nRF Connect SDK – ESL Profile and Service V2.4.0</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Sample description</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/previous_release/esl_ap_sample_description_240.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="sample-description">
<span id="central-esl-desc-v240"></span><h1>Sample description<a class="headerlink" href="#sample-description" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#requirements" id="id6">Requirements</a></p></li>
<li><p><a class="reference internal" href="#overview" id="id7">Overview</a></p></li>
<li><p><a class="reference internal" href="#auto-onboarding-and-auto-past" id="id8">Auto Onboarding and Auto PAST</a></p></li>
<li><p><a class="reference internal" href="#user-interface" id="id9">User interface</a></p>
<ul>
<li><p><a class="reference internal" href="#setup-transfer-images-from-pc-to-ap-over-usb" id="id10">Setup - Transfer Images from PC to AP over USB</a></p></li>
<li><p><a class="reference internal" href="#configuration-options" id="id11">Configuration options</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-and-running" id="id12">Building and running</a></p>
<ul>
<li><p><a class="reference internal" href="#testing-with-other-devkits" id="id13">Testing with other DevKits</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dependencies" id="id14">Dependencies</a></p></li>
</ul>
</div>
<p>The Central ESL sample acts as Access Point(AP) defined in <a class="reference external" href="https://www.bluetooth.com/specifications/specs/electronic-shelf-label-profile-1-0/">Electronic Shelf Label Profile</a> which controls and manages numbers of ESL Tag.
It uses the library <a class="reference internal" href="../esl_service_client.html#esl-service-client-readme"><span class="std std-ref">Electronic Shelf Label Service (ESLS) client</span></a> to communicates with ESLs connectionlessly when one or more ESLs are in the Synchronized state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This sample is experimental and currently in its testing phase. It has been primarily developed for estimation and experimental purposes and is not yet optimized or sufficiently tested for production use. While it provides valuable insight into potential features and functions, its current state may not reflect the final product’s quality or stability. Therefore, it should not be used for production until further updates and refinements are made.</p>
</div>
<div class="section" id="requirements">
<h2><a class="toc-backref" href="#id6">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline"></a></h2>
<p>The sample supports the following development kits:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 12%" />
<col style="width: 30%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hardware platforms</p></th>
<th class="head"><p>PCA</p></th>
<th class="head"><p>Board name</p></th>
<th class="head"><p>Build target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nRF5340 DK</p></td>
<td><p>PCA10095</p></td>
<td><p>nrf5340dk_nrf5340_cpuapp</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Thingy:53</p></td>
<td><p>PCA20053</p></td>
<td><p>thingy53_nrf5340_cpuapp</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">thingy53_nrf5340_cpuapp</span></code></p></td>
</tr>
</tbody>
</table>
<p>The sample also requires another development kit running a compatible sample (see <a class="reference internal" href="../esl_tag.html#peripheral-esl"><span class="std std-ref">Bluetooth: Peripheral ESL</span></a>).</p>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id7">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<dl>
<dt>In this sample, Nordic provides host interface architecture and full set of <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> to control the AP and auto onboarding feature.</dt><dd><div class="figure align-default">
<img alt="../_images/esl_ap_architecture.png" src="../_images/esl_ap_architecture.png" />
</div>
</dd>
</dl>
<p>This Sample is an easy-to-use Serialized Access Point which can be used as a development platform to help customers test and develop ESL Tags (<a class="reference internal" href="../esl_tag.html#peripheral-esl"><span class="std std-ref">Bluetooth: Peripheral ESL</span></a>).</p>
<p>Beside this, this sample can  be used also in combination with more powerful hosts(e.g.: Linux PC) in order to develop/implement a full ESL AP application.
The AP provides serial connection to the HOST (PC/Linux) via USB interface (nRF USB – J3 connector on <a class="reference external" href="https://www.nordicsemi.com/Software-and-Tools/Development-Kits/nRF5340-DK">nRF5340 DK</a>; USB-C connector on <a class="reference external" href="https://www.nordicsemi.com/thingy53">Nordic Thingy:53</a>). Two virtual COMs are associated this the USB port:</p>
<blockquote>
<div><ul class="simple">
<li><p>Shell command COM port (used for shell commands)</p></li>
<li><p>SMP/mcumgr COM port (used for transfer images from PC to AP)</p></li>
</ul>
</div></blockquote>
<p>When booting up, the Access Point starts periodic advertising with response(PAwR) with predefined PAwR parameters.
At this point, the AP is ready to scan for new tags, connect / configure / synchronize new tags, send encrypted commands, receive encrypted responses (refer to ESL Service and ESL profile). All such functionalities are exposed via <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a>. However, since this process may involve many decisions and many shell commands inputs, in order to make testing / developing process easier, this sample provides also a <a class="reference internal" href="../esl_ap_sample_description.html#bt-esl-ap-auto-mode"><span class="std std-ref">auto onboarding</span></a> feature.</p>
</div>
<div class="section" id="auto-onboarding-and-auto-past">
<span id="central-esl-auto-onboarding-and-auto-past-v240"></span><h2><a class="toc-backref" href="#id8">Auto Onboarding and Auto PAST</a><a class="headerlink" href="#auto-onboarding-and-auto-past" title="Permalink to this headline"></a></h2>
<p>Auto Onboarding feature , which associates Tags automatically to the AP, by continuously &amp; automatically performing the following tasks in the background:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Scan for new unsynchronized ESL Tags(new ones or previously associated)</p></li>
<li><p>Connect and configure them one by one: e.g. read/write characteristics (including AP sync maetiral, ESL Address, etc), send pre-loaded images (i.e. images previously transferred from the PC to the AP)</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Max number of devices that can be handled by the automatic onboarding feature is depending on these Kconfig.
<code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_MAX_GROUP</span></code> (default <strong>128</strong>), <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_DEFAULT_GROUP_ID</span></code> (default <strong>0</strong>), <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_DEFAULT_ESL_ID</span></code> (default <strong>0</strong>), <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_BT_ESL_AP_AUTO_TAG_PER_GROUP</span></code> (default <strong>8</strong>).</p>
<div class="line-block">
<div class="line">With default configuration, Tags are added from Group <strong>0</strong> with increasing ESL_ID (0,1,2,3,4,5,6,7) until reaching 8th. Then, the next Tag will be added to Group <strong>1</strong> with ESL_ID <strong>0</strong>, and so on. For handling more devices, shell commands should be used.</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The AP will store information of associated ESL Tags into non-volatile database (external SPI flash) with <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_BT_ESL_TAG_STORAGE</span></code> enabled. This option is mandatory reruired for auto onboarding feature.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During association, the AP sends images only to those tags that are running the EPD variant <a class="reference internal" href="../esl_tag.html#peripheral-esl"><span class="std std-ref">Bluetooth: Peripheral ESL</span></a> sample (AP reads characteristics of the new associated tags, and only if it is recognized as specific tag type , it will transfer the image)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can observe the output log of auto onboarding process on the shell terminal. Here an example of successful onboarding of ESL Tag (ESL Peripheral without EPD):</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>TAG_SCANNED:<span class="w"> </span><span class="m">1</span>,C9:AC:AD:A6:E5:79<span class="w"> </span><span class="o">(</span>random<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>list
<span class="go">Connected:Conn_idx:00</span>
<span class="gp">#</span>SCANNED_TAG:
<span class="gp">#</span>DISCOVERY:<span class="w"> </span><span class="m">1</span>,0x00
<span class="gp">#</span>CONFIGURED:<span class="w"> </span><span class="m">1</span>,0x0000,0x0001
<span class="gp">#</span>BASIC_STATE:1,0x0000
<span class="go">SERVICE_NEEDED:off</span>
<span class="go">SYNCHRONIZED:off</span>
<span class="go">ACTIVE_LED:off</span>
<span class="go">PENDING_LED_UPDATE:off</span>
<span class="go">PENDING_DISPLAY_UPDATE:off</span>
<span class="go">BASIC_RFU:off</span>
<span class="gp">#</span>PAST:1,00
<span class="go">Disconnected:Conn_idx:0x00 (reason 0x13)</span>
</pre></div>
</div>
</div></blockquote>
<p>Here an example of successful onboarding of ESL Tag (ESL Peripheral with EPD variant):</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>TAG_SCANNED:<span class="w"> </span><span class="m">1</span>,C9:AC:AD:A6:E5:79<span class="w"> </span><span class="o">(</span>random<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>list
<span class="go">Connected:Conn_idx:00</span>
<span class="gp">#</span>SCANNED_TAG:
<span class="gp">#</span>DISCOVERY:<span class="w"> </span><span class="m">1</span>,0x00
<span class="gp">#</span>CONFIGURED:<span class="w"> </span><span class="m">1</span>,0x0000,0x0001
<span class="gp">#</span>BASIC_STATE:1,0x0000
<span class="go">SERVICE_NEEDED:off</span>
<span class="go">SYNCHRONIZED:off</span>
<span class="go">ACTIVE_LED:off</span>
<span class="go">PENDING_LED_UPDATE:off</span>
<span class="go">PENDING_DISPLAY_UPDATE:off</span>
<span class="go">BASIC_RFU:off</span>
<span class="gp">#</span>OTS_WRITE:1,0,0,esl_image_09
<span class="gp">#</span>OTS_WRITTEN:1,00,0,15006,0x1754215a
<span class="gp">#</span>OTS_WRITE:1,0,1,esl_image_0A
<span class="gp">#</span>OTS_WRITTEN:1,00,1,15006,0xdf631601
<span class="gp">#</span>PAST:1,00
<span class="go">Disconnected:Conn_idx:0x00 (reason 0x13)</span>
</pre></div>
</div>
</div></blockquote>
<p>0000 Is the ESL Address in hexadecimal, where two MSB are the Group ID, and two LSB are ESL ID.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Sends PAST info to unsynchronized ESL Tag</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ESL client provides <a class="reference internal" href="../esl_ap_sample_description.html#bt-esl-ap-auto-past-tag"><span class="std std-ref">auto PAST</span></a> feature. If a previously associated Tag is scanned (i.e. if ESL Tag is in database), Access Point will connect using the previously stored Bluetooth bonding information and then configure the tag accordingly to previous settings stored in the database (note: EPD images will not transferred in this case – EPD images are transferred only the first time tag gets associated to the AP, if images are available in the AP).
Access Point then will send PAST automatically.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if a previously associated tag is reset (i.e. it has erased also the bonding information with the AP), the AP will not be able to connect to that tag (because it will try to connect with the old bonding keys in the AP database).
Erase the AP database by using <strong>Button 2</strong> to clear all content of database or shell command to clear specified Tag to start the process again.</p>
</div>
</div></blockquote>
<p>Once tags are onboarded and synchronized to the AP, commands can be sent/received using the <a class="reference internal" href="../esl_ap_sample_description.html#central-esl-user-interface"><span class="std std-ref">User interface</span></a> (either using the DK buttons features in the DK and/or the <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> by shell commands ).
Auto onboarding feature should be used only for testing/development or as a starting point for more complex applications. For production (ESL AP), shell commend is recommended.</p>
</div>
<div class="section" id="user-interface">
<span id="central-esl-user-interface-v240"></span><h2><a class="toc-backref" href="#id9">User interface</a><a class="headerlink" href="#user-interface" title="Permalink to this headline"></a></h2>
<p>This sample provides two ways to control the AP. One is through buttons on the development kit, the other is through shell commands.</p>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-REsgYnV0dG9uIGZlYXR1cmU=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-REsgYnV0dG9uIGZlYXR1cmU=" name="REsgYnV0dG9uIGZlYXR1cmU=" role="tab" tabindex="0">DK button feature</button><button aria-controls="panel-0-U2hlbGwgY29tbWFuZA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-U2hlbGwgY29tbWFuZA==" name="U2hlbGwgY29tbWFuZA==" role="tab" tabindex="-1">Shell command</button></div><div aria-labelledby="tab-0-REsgYnV0dG9uIGZlYXR1cmU=" class="sphinx-tabs-panel group-tab" id="panel-0-REsgYnV0dG9uIGZlYXR1cmU=" name="REsgYnV0dG9uIGZlYXR1cmU=" role="tabpanel" tabindex="0"><p>Such User Interface takes advantage of the Auto Onboarding feature</p>
<dl>
<dt>Button 1:</dt><dd><p>Press to start Auto onboarding AP feature.</p>
<ol class="arabic simple">
<li><p>AP scan and connect unsynchonrized ESL Tag.</p></li>
<li><p>AP configure unsynchronized ESL Tag.</p></li>
<li><p>AP send image file to unsynchronized ESL Tag.</p></li>
<li><p>AP send PAST info to unsynchronized ESL Tag.</p></li>
</ol>
</dd>
<dt>Button 2: (only on <a class="reference external" href="https://www.nordicsemi.com/Software-and-Tools/Development-Kits/nRF5340-DK">nRF5340 DK</a>, not available on the <a class="reference external" href="https://www.nordicsemi.com/thingy53">Nordic Thingy:53</a>)</dt><dd><p>Erase the database of associated ESL Tags which is used by <a class="reference internal" href="../esl_ap_sample_description.html#central-esl-auto-onboarding-and-auto-past"><span class="std std-ref">Auto Onboarding and Auto PAST</span></a> from the AP.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you push this button, you should also push <strong>Button 1</strong> on the ESL Tag as well to reset the ESL Tag.</p>
<p>This procedure will not erase the EPD images stored in the AP (if any transferred).</p>
</div>
</dd>
<dt>Button 3: (only on <a class="reference external" href="https://www.nordicsemi.com/Software-and-Tools/Development-Kits/nRF5340-DK">nRF5340 DK</a>, not available on the <a class="reference external" href="https://www.nordicsemi.com/thingy53">Nordic Thingy:53</a>)</dt><dd><p>Change Image on the ESL Tag display.</p>
<p>By pressing this button, AP sends a <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a> to a specific group.
Commands rotate at each press of the button, in the following order, starting from Group <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_DEFAULT_GROUP_ID</span></code> (Default <strong>0</strong>) to Group 2 <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_BT_ESL_AP_GROUP_PER_BUTTON</span></code> (Default <strong>3</strong>)</p>
<p>e.g.:0x7 (display 0 image 0 broadcast) is sent to Group 0</p>
<p>0x8 (Display 0 image 1 broadcast) is sent to Group 0</p>
<p>0x12 (Tag default ESL_ID ~ ESL_ID+10 Display Img 0) is sent to Group 0</p>
<p>0x13 (Tag default ESL_ID ~ ESL_ID+10 Display img 1) is sent to Group 0</p>
<p>0x7 (display 0 image 0 broadcast) is sent to Group 1 and so on, until reaching Group <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_BT_ESL_AP_GROUP_PER_BUTTON</span></code> (Default <strong>3</strong>) then turning back <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_DEFAULT_GROUP_ID</span></code> (Default <strong>0</strong>)</p>
</dd>
<dt>Button 4: (only on <a class="reference external" href="https://www.nordicsemi.com/Software-and-Tools/Development-Kits/nRF5340-DK">nRF5340 DK</a>, not available on the <a class="reference external" href="https://www.nordicsemi.com/thingy53">Nordic Thingy:53</a>)</dt><dd><p>Flash ESL Tag LED in predefined pattern.</p>
<p>By pressing this button, AP sends a predefined <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a> to a specific group.
Commands rotate at each press of the button, in the following order, starting from Group <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_DEFAULT_GROUP_ID</span></code> (Default <strong>0</strong>) to Group <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_BT_ESL_AP_GROUP_PER_BUTTON</span></code> (Default <strong>3</strong>)</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Button 3 and 4 will continually send ESL command through PAwR and cycles from group <code class="docutils literal notranslate"><span class="pre">0</span></code> to <a class="reference internal" href="../esl_ap_sample_description.html#bt-esl-ap-group-per-button"><span class="std std-ref">CONFIG_BT_ESL_AP_GROUP_PER_BUTTON</span></a></p>
</div>
<dl>
<dt>LED 1:</dt><dd><p>Stable on means AP is booted-up.</p>
<p>Start blinking, signaling the Auto Onboarding feature on the AP is activate: AP is scanning for ESL tags, connecting one by one to them, configuring them and transferring synchronization (PAST).</p>
</dd>
</dl>
</div><div aria-labelledby="tab-0-U2hlbGwgY29tbWFuZA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-U2hlbGwgY29tbWFuZA==" name="U2hlbGwgY29tbWFuZA==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Start scan continuously with command:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c scan 1 0</span>
</pre></div>
</div>
<p>The sample shows the following output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>SCAN:start
<span class="gp">#</span>TAG_SCANNED:<span class="w"> </span><span class="m">1</span>,XX:XX:XX:XX:XX:XX<span class="w"> </span><span class="o">(</span>random<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>list
</pre></div>
</div>
<ul class="simple">
<li><p>Connect ESL Tag to connection index 0 with command:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c acl connect 0</span>
</pre></div>
</div>
<p>The sample shows the following output to indicate that connection and service discovery is succeed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Connected:Conn_idx:00</span>
<span class="gp">#</span>DISCOVERY:<span class="w"> </span><span class="m">1</span>,0x00
</pre></div>
</div>
<ul class="simple">
<li><p>Optionally, AP can connect Tag by knowing BLE address out-of-band without scanning:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c acl connect_addr 0 AA:BB:CC:DD:EE:FF</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Configure ESL Tag to esl address <code class="docutils literal notranslate"><span class="pre">0x0101</span></code> with command:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c acl configure 0 0101</span>
</pre></div>
</div>
<p>The sample shows the following output to indicate that ESL Tag has been configured and update complete OP code sent:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Configure conn_idx 0 esl_addr 0x0101</span>
<span class="go">CONFIGURED: 1,0x0000,0x0101</span>
<span class="gp">#</span>BASIC_STATE:1,0x0101
<span class="go">SERVICE_NEEDED:off</span>
<span class="go">SYNCHRONIZED:off</span>
<span class="go">ACTIVE_LED:off</span>
<span class="go">PENDING_LED_UPDATE:off</span>
<span class="go">PENDING_DISPLAY_UPDATE:off</span>
<span class="go">BASIC_RFU:off</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Read information of connected Tag for further use with command:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c esl_c dump</span>
</pre></div>
</div>
<p>The sample shows the following output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">AP Sync Key</span>
<span class="go">00000000: 6d 3a 14 4f f1 19 45 f7  4d 5e a8 50 75 45 b9 d2 |m:.O..E. M^.PuE..|</span>
<span class="go">00000010: ff da 94 bd 8e 9b 33 61                          |......3a         |</span>
<span class="go">Randomizer</span>
<span class="go">00000000: 60 83 38 82 f6                                   |`.8..            |</span>
<span class="gp">#</span>ABSTIME:570155
<span class="go">Connected Tag counts 0</span>
<span class="go">Tag 0</span>
<span class="go">ESL handles: 0x002e 0x0030 0x0032 0x0034 0x0036 0x0038 0x003a 0x003c 0x003e 0x003f 0x0016</span>
<span class="go">OTS client handles:</span>
<span class="go">start_handle 0x0001</span>
<span class="go">end_handle 0xffff</span>
<span class="go">obj_feat 0x001b</span>
<span class="go">obj_name 0x001d</span>
<span class="go">obj_type 0x001f</span>
<span class="go">obj_size 0x0021</span>
<span class="go">obj_prop 0x0025</span>
<span class="go">obj_created 0x0000</span>
<span class="go">obj_modified 0x0000</span>
<span class="go">obj_id 0x0023</span>
<span class="go">obj_ocap 0x0027</span>
<span class="go">obj_olcp 0x002a</span>
<span class="go">BLE ADDR:C8:6D:40:1E:C2:AE (ra#ndom)</span>
<span class="go">CHR_READ:1</span>
<span class="go">ESL_ADDR:0x0101</span>
<span class="go">RSP_KEY:0x0b73c85e8a37d6094fe536812f6720a06d60d1cf4c9eadd1</span>
<span class="go">Max_image_index:1</span>
<span class="go">DISPLAY:1,0x6400640001</span>
<span class="go">SENSOR:2,0x00540000000115198794</span>
<span class="go">Sensor 0 Mesh property ID Sensor type: 0x0054</span>
<span class="go">Sensor 1 vendor_specific_sensor Company ID: 0x1915 Sensor Code: 0x9487</span>
<span class="go">LED:4,0x4c4c4c4c</span>
<span class="go">led idx 0, type Mono color 0x0c:Green</span>
<span class="go">led idx 1, type Mono color 0x0c:Green</span>
<span class="go">led idx 2, type Mono color 0x0c:Green</span>
<span class="go">led idx 3, type Mono color 0x0c:Green</span>
<span class="go">PNPID:VID:0x1915, PID:0x5484</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Send image(optional) on AP index <cite>0</cite> to ESL Tag image index <cite>0</cite> connection <cite>0</cite> with command:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c obj_c write 0 0 0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This command is equivalent to previous one. You can use filename without original pattern <cite>ots_image_XX</cite></p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c obj_c write_filename 0 0 ots_image_00</span>
</pre></div>
</div>
<p>The sample shows the following output indicate that image has been transferred:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>OTS_WRITE:1,0,0,esl_image_00
<span class="gp">#</span>OTS_WRITTEN:1,00,0,1246,0x7bd5f88
</pre></div>
</div>
<ul class="simple">
<li><p>After configured all data and sent all image, use periodic advertising sync transfer procedure to let ESL Tag entering synced with command:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c acl past 0</span>
</pre></div>
</div>
<p>The sample shows the following output indicate that ESL received PAST and disconnect:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PAST:1,00</span>
<span class="go">Disconnected:Conn_idx:0x00 (reason 0x13)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ping ESL Tag of ESL address <cite>0x0101</cite> with PAwR by raw ESL payload:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c pawr push_sync_buf 1 0001</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Control LED 0 to flash to all ESL Tags of group <cite>0</cite> with PAwR with <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a>:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c pawr update_pawr 1 0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Turn LED 0 off to all ESL Tags of group <cite>0</cite> with PAwR with <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a>:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c pawr update_pawr 4 0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Display image 0 to all ESL Tags of group <cite>1</cite> with PAwR with <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a>:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">esl_c pawr update_pawr 7 1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>See <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> for a list of available subcommands.</p></li>
</ul>
</div></div>
</div></blockquote>
<div class="section" id="setup-transfer-images-from-pc-to-ap-over-usb">
<h3><a class="toc-backref" href="#id10">Setup - Transfer Images from PC to AP over USB</a><a class="headerlink" href="#setup-transfer-images-from-pc-to-ap-over-usb" title="Permalink to this headline"></a></h3>
<p>One of major task of Access Point is to provide images to ESL Tag in configuring and updating state.
Before activating auto onboarding (<strong>Button 1</strong>) or, anytime before sending images using <a class="reference external" href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/zephyr/connectivity/bluetooth/api/services.html">Object Transfer Service</a> via shell commands between AP and Tag, it is necessary to transfer the images from PC to the AP (in external flash) over USB.
<a class="reference external" href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/zephyr/services/device_mgmt/smp_protocol.html">mcumgr_smp_protocol_specification</a> is used over the other COM port available over USB. Here example:</p>
<ol class="arabic simple">
<li><p>Install <a class="reference external" href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/zephyr/services/device_mgmt/mcumgr.html">Mcumgr Command-line Tool</a> tool</p></li>
<li><p>Prepare the images to be transferred. The image format is depending on what EPD and color depth your are using.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nordic provides two sample files that can be used with the <a class="reference internal" href="../esl_tag.html#peripheral-esl"><span class="std std-ref">Bluetooth: Peripheral ESL</span></a> EPD variant.</p>
<ul class="simple">
<li><p>EPD format: Use this format on Access Point <a class="reference download external" download="" href="https://github.com/NordicPlayground/nrf-esl-bluetooth/raw/doc/docs/esl_sample_image/esl_image_bt"><code class="xref download docutils literal notranslate"><span class="pre">esl_image_bt</span></code></a> <a class="reference download external" download="" href="https://github.com/NordicPlayground/nrf-esl-bluetooth/raw/doc/docs/esl_sample_image/esl_image_nordic"><code class="xref download docutils literal notranslate"><span class="pre">esl_image_nordic</span></code></a></p></li>
<li><p>BMP format: This format is only for reference <a class="reference download external" download="" href="https://github.com/NordicPlayground/nrf-esl-bluetooth/blob/doc/docs/esl_sample_image/esl_image_00_240x120_bt.BMP"><code class="xref download docutils literal notranslate"><span class="pre">esl_image_00_240x120_bt.BMP</span></code></a> <a class="reference download external" download="" href="https://github.com/NordicPlayground/nrf-esl-bluetooth/blob/doc/docs/esl_sample_image/esl_image_01_240x120_nordic_logo.BMP"><code class="xref download docutils literal notranslate"><span class="pre">esl_image_01_240x120_nordic_logo.BMP</span></code></a></p></li>
</ul>
</div>
<ol class="arabic" start="3">
<li><p>Transfer images from the PC to the AP: run from cmd /command line</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype=&quot;serial&quot; --connstring=&quot;COM4,baud=115200,mtu=512&quot; fs upload esl_image_bt /ots_image/esl_image_00</span>
<span class="go">mcumgr --conntype=&quot;serial&quot; --connstring=&quot;COM4,baud=115200,mtu=512&quot; fs upload esl_image_nordic /ots_image/esl_image_01</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to change <strong>COM4</strong> to the right COM port in your PC.
Images are stored in external non-volatile flash.</p>
<p>Non-volatile external flash is kept even after reset of DK (power cycle), or after programming or after AP database erase (<strong>Button 2</strong>)</p>
<p>Once the images are in the AP, it is possible to transfer them to the tags at any time using shell commands, assuming the AP and Tag are in an ACL connection. Refer to <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> for this.</p>
</div>
</li>
</ol>
<p>#. As an alternative, for demo purposes, Auto Onboarding feature can be used:
If auto onboarding is started after the transfer of image (i.e. a new Tag is associated for the first time after transferring the image to the AP and after pushing <strong>Button 1</strong>), the AP will transfer automatically these images to the ESL Tag DevKit with EPD shield, during the associating procedure.</p>
</div>
<div class="section" id="configuration-options">
<span id="ap-sample-config-options-v240"></span><h3><a class="toc-backref" href="#id11">Configuration options</a><a class="headerlink" href="#configuration-options" title="Permalink to this headline"></a></h3>
<p>Check and configure the following Kconfig options:</p>
<dl class="simple" id="bt-esl-ap-security-enabled-v240">
<dt>BT_ESL_SECURITY_ENABLED</dt><dd><p>This enables BT SMP and bonding which are security requirement of ESL Profile. Disable BLE security of the ESL service for debugging purposes.</p>
</dd>
</dl>
<dl id="bt-esl-ap-auto-mode-v240">
<dt>BT_ESL_AP_AUTO_MODE</dt><dd><p>Enable auto onboarding feature. With this feature AP will scan and connect unsynchonrized ESL Tag, configure and send predefined image to unsynchronized ESL Tag, send PAST info to unsynchronized ESL Tag automatically.
This feature also stores response key material for all of associated ESL tags. The key material will be used to decrypt response EAD from ESL Tag when using predefined ESL packet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Auto onboarding feature is meant to be used for small scale testing and development purposes. For larger scale, <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> give more flexibility and control over the AP functionalities.</p>
</div>
</dd>
</dl>
<dl class="simple" id="bt-esl-ap-auto-tag-per-group-v240">
<dt>BT_ESL_AP_AUTO_TAG_PER_GROUP</dt><dd><dl class="simple">
<dt>How many tags should keep in same group for auto onboarding. Tag number exceeds this number should be in next group. Otherwise, response key material slot is not enough for all tags in same group.</dt><dd><p>How to choose this number depends on what scenario we want to show.
Less or equal to <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_MAX_RESPONSE_SLOT_BUFFER</span></code> demostrates decrypts response EAD on-the-fly.
Greater than <code class="xref std std-option docutils literal notranslate"><span class="pre">CONFIG_ESL_CLIENT_MAX_RESPONSE_SLOT_BUFFER</span></code> demostrates ESL AP able to control large amount of tags at the same time.”</p>
</dd>
</dl>
</dd>
</dl>
<dl class="simple" id="bt-esl-ap-group-per-button-v240">
<dt>BT_ESL_AP_GROUP_PER_BUTTON</dt><dd><p><strong>Button 3</strong> and <strong>Button 4</strong> could be used as user interface. <strong>Button 3</strong> will send <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a> to all tags in group <cite>x</cite> to change image on display. <strong>Button 4</strong> will send predefined command to all tags in group <cite>x</cite> to flash LED in predefined pattern.
This option defines how many groups should be used for this feature. For example, if this option is set to <cite>2</cite>, <strong>Button 3</strong> and <strong>Button 4</strong> will send <a class="reference internal" href="../esl_ap_subcommands.html#predefined-esl-packet"><span class="std std-ref">Predefined ESL sync packet</span></a> to all tags in group <cite>0</cite> and <cite>1</cite> alternatively.</p>
</dd>
</dl>
<dl id="bt-esl-ap-auto-past-tag-v240">
<dt>BT_ESL_AP_AUTO_PAST_TAG</dt><dd><p>Enable auto PAST feature. With this feature AP will send PAST automatically if connected ESL Tag is in database.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Auto PAST feature is meant to be used for small scale testing and development purposes. For larger scale, <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> give more flexibility and control over the AP functionalities.</p>
</div>
</dd>
</dl>
<dl class="simple" id="bt-esl-ap-pts-v240">
<dt>BT_ESL_AP_PTS</dt><dd><p>Enable PTS feature. With this feature AP will send PTS command to connected ESL Tag. This feature is used for PTS test only.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="building-and-running">
<h2><a class="toc-backref" href="#id12">Building and running</a><a class="headerlink" href="#building-and-running" title="Permalink to this headline"></a></h2>
<p>To build the sample with Visual Studio Code, follow the steps listed on the <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/get_started/build_app_ncs.html">How to build an application</a> page in the nRF Connect for VS Code extension documentation. See <cite>Building and programming an application &lt;https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/nrf/getting_started/programming.html#gs-programming&gt;</cite> for other building and programming scenarios and <a class="reference external" href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/nrf/getting_started/testing.html">Testing and debugging an application</a> for general information about testing and debugging in the nRF Connect SDK.</p>
<div class="section" id="testing-with-other-devkits">
<h3><a class="toc-backref" href="#id13">Testing with other DevKits</a><a class="headerlink" href="#testing-with-other-devkits" title="Permalink to this headline"></a></h3>
<p>After programming the sample to your development kit, complete the following steps to test it:</p>
<ol class="arabic simple">
<li><p>Connect the computer to the connecter labeled <strong>nRF USB</strong> on DevKit or the USB connector on the Thingy:53 using a USB cable. Turn on the kit; the computer will assign to the kit two virtual COM ports (Windows) or ttyACM devices (Linux), which are visible in the Device Manager. One port is for <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a>. The other port is for EPD image transfer (SMP protocol).</p></li>
<li><p>Connect to the kit that runs this sample with a terminal emulator (for example, PuTTY or the Serial Terminal in nRF Connect for Desktop). Connect with the following settings:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Baud rate: 115200</p></li>
<li><p>8 data bits</p></li>
<li><p>1 stop bit</p></li>
<li><p>No parity</p></li>
<li><p>HW flow control: None</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To know if the right port is selected, enter new line and “ESL_AP:~$” should show up.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Optionally, connect the RTT console to display debug messages.</p></li>
<li><p>Optionally (required for out of the box testing in combination ESL Tag sample with EPD), transfer the images from PC to the AP.</p></li>
<li><p>Test the sample either by by auto onboarding feature or using <a class="reference internal" href="../esl_ap_subcommands.html#central-esl-subcommands"><span class="std std-ref">Central ESL subcommands</span></a> manually as described in <a class="reference internal" href="../esl_ap_sample_description.html#central-esl-user-interface"><span class="std std-ref">User interface</span></a>.</p></li>
</ol>
</div>
</div>
<div class="section" id="dependencies">
<h2><a class="toc-backref" href="#id14">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline"></a></h2>
<p>This application uses the following nRF Connect SDK libraries:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../esl_service_client.html#esl-service-client-readme"><span class="std std-ref">Electronic Shelf Label Service (ESLS) client</span></a></p></li>
</ul>
<p>In addition, it uses the following Zephyr libraries:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">include/zephyr/types.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">boards/arm/nrf*/board.h</span></code></p></li>
<li><p><a class="reference external" href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/zephyr/kernel/services/index.html">Kernel Services</a></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">include/kernel.h</span></code></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/2.4.0/zephyr/connectivity/bluetooth/api/index.html">Bluetooth APIs</a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">include/bluetooth/bluetooth.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include/bluetooth/gatt.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include/bluetooth/hci.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include/bluetooth/uuid.h</span></code></p></li>
</ul>
</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2023, Nordic Semiconductor.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../_static/images/nordic.svg" border="0"/></a>
</td>
</tr>
</table>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>